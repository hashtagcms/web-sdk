import{default as e}from"axios";e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.common.Accept="application/json";const t=document.head.querySelector('meta[name="csrf-token"]');t?(e.defaults.headers.common["X-CSRF-TOKEN"]=t.content,e.defaults.withCredentials=!0):console.warn('HashtagCms: CSRF token not found. Add <meta name="csrf-token" content="..."> to your HTML head.'),"undefined"==typeof window||window.axios||(window.axios=e);const s=e,r={required:e=>"string"==typeof e?e.trim().length>0:null!=e&&""!==e,email:e=>!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),url:e=>{if(!e)return!0;try{return new URL(e),!0}catch{return!1}},number:e=>!e||!isNaN(e)&&!isNaN(parseFloat(e)),integer:e=>!e||Number.isInteger(Number(e)),min:(e,t)=>{if(!e)return!0;const s=parseFloat(e);return!isNaN(s)&&s>=parseFloat(t)},max:(e,t)=>{if(!e)return!0;const s=parseFloat(e);return!isNaN(s)&&s<=parseFloat(t)},minlength:(e,t)=>!e||e.toString().length>=parseInt(t),maxlength:(e,t)=>!e||e.toString().length<=parseInt(t),pattern:(e,t)=>!e||new RegExp(t).test(e),phone:e=>!e||/^[\+]?[(]?[0-9]{1,4}[)]?[-\s\.]?[(]?[0-9]{1,4}[)]?[-\s\.]?[0-9]{1,9}$/.test(e.replace(/\s/g,"")),alphanumeric:e=>!e||/^[a-zA-Z0-9]+$/.test(e),alpha:e=>!e||/^[a-zA-Z]+$/.test(e),date:e=>{if(!e)return!0;const t=new Date(e);return t instanceof Date&&!isNaN(t)},match:(e,t)=>{const s=document.getElementById(t)||document.querySelector(t);return!s||e===s.value}},a={required:"This field is required",email:"Please enter a valid email address",url:"Please enter a valid URL",number:"Please enter a valid number",integer:"Please enter a valid integer",min:"Value must be at least {0}",max:"Value must be at most {0}",minlength:"Please enter at least {0} characters",maxlength:"Please enter no more than {0} characters",pattern:"Please match the requested format",phone:"Please enter a valid phone number",alphanumeric:"Please use only letters and numbers",alpha:"Please use only letters",date:"Please enter a valid date",match:"Fields do not match"};class o{constructor(e,t={}){if(this.form=this._getFormElement(e),!this.form)throw new Error("Form element not found");this.options={validateOnBlur:!1!==t.validateOnBlur,validateOnInput:t.validateOnInput||!1,validateOnSubmit:!1!==t.validateOnSubmit,showErrors:!1!==t.showErrors,errorClass:t.errorClass||"is-invalid",successClass:t.successClass||"is-valid",errorMessageClass:t.errorMessageClass||"invalid-feedback",customRules:t.customRules||{},customMessages:t.customMessages||{},scrollToError:t.scrollToError||!1,focusOnError:!1!==t.focusOnError},this.rules={...r,...this.options.customRules},this.messages={...a,...this.options.customMessages},this.errors={},this._init()}_getFormElement(e){return"string"==typeof e?document.getElementById(e)||document.querySelector(e):e}_init(){this.options.validateOnSubmit&&this.form.addEventListener("submit",e=>{e.preventDefault(),this.validate()}),(this.options.validateOnBlur||this.options.validateOnInput)&&this.form.querySelectorAll("input, select, textarea").forEach(e=>{this.options.validateOnBlur&&e.addEventListener("blur",()=>this.validateField(e)),this.options.validateOnInput&&e.addEventListener("input",()=>this.validateField(e))})}_getFieldRules(e){const t=[];e.hasAttribute("required")&&t.push({name:"required"});const s=e.getAttribute("type");return"email"===s?t.push({name:"email"}):"url"===s?t.push({name:"url"}):"number"===s?t.push({name:"number"}):"tel"===s?t.push({name:"phone"}):"date"===s&&t.push({name:"date"}),e.hasAttribute("min")&&t.push({name:"min",param:e.getAttribute("min")}),e.hasAttribute("max")&&t.push({name:"max",param:e.getAttribute("max")}),e.hasAttribute("minlength")&&t.push({name:"minlength",param:e.getAttribute("minlength")}),e.hasAttribute("maxlength")&&t.push({name:"maxlength",param:e.getAttribute("maxlength")}),e.hasAttribute("pattern")&&t.push({name:"pattern",param:e.getAttribute("pattern")}),e.hasAttribute("data-validate")&&e.getAttribute("data-validate").split("|").forEach(e=>{const[s,r]=e.split(":");t.push({name:s.trim(),param:r?r.trim():void 0})}),t}_getFieldValue(e){if("checkbox"===e.type)return e.checked;if("radio"===e.type){const t=this.form.querySelector(`input[name="${e.name}"]:checked`);return t?t.value:""}return e.value}_getErrorMessage(e,t,s){const r=s.getAttribute(`data-${e}-message`);if(r)return r;const a=s.getAttribute("name")||s.getAttribute("id");if(this.messages[a]&&this.messages[a][e])return this.messages[a][e];let o=this.messages[e]||"Invalid value";return void 0!==t&&(o=o.replace("{0}",t)),o}validateField(e){const t=e.getAttribute("name")||e.getAttribute("id"),s=this._getFieldValue(e),r=this._getFieldRules(e);delete this.errors[t];for(const a of r){const r=this.rules[a.name];if(r){if(!(void 0!==a.param?r(s,a.param,e):r(s,e))){const s=this._getErrorMessage(a.name,a.param,e);this.errors[t]={field:e,rule:a.name,message:s};break}}else console.warn(`Validation rule "${a.name}" not found`)}return this.options.showErrors&&this._updateFieldUI(e,t),!this.errors[t]}_updateFieldUI(e,t){const s=!!this.errors[t];e.classList.remove(this.options.errorClass,this.options.successClass),s?e.classList.add(this.options.errorClass):e.value&&e.classList.add(this.options.successClass),this._removeErrorMessage(e),s&&this._showErrorMessage(e,this.errors[t].message)}_showErrorMessage(e,t){const s=document.createElement("div");s.className=this.options.errorMessageClass,s.textContent=t,s.setAttribute("data-error-for",e.getAttribute("name")||e.getAttribute("id")),(e.closest(".form-group")||e.closest(".form-field")||e.parentElement).appendChild(s)}_removeErrorMessage(e){const t=e.getAttribute("name")||e.getAttribute("id"),s=(e.closest(".form-group")||e.closest(".form-field")||e.parentElement).querySelector(`[data-error-for="${t}"]`);s&&s.remove()}validate(e){this.errors={},this.form.querySelectorAll('input:not([type="submit"]):not([type="button"]), select, textarea').forEach(e=>{e.disabled||this.validateField(e)});const t=0===Object.keys(this.errors).length;if(!t&&this.options.focusOnError){const e=Object.values(this.errors)[0];e&&e.field&&(e.field.focus(),this.options.scrollToError&&e.field.scrollIntoView({behavior:"smooth",block:"center"}))}return"function"==typeof e&&e(t,this.errors,this.getFormData()),t}getFormData(){const e=new FormData(this.form),t={};for(const[s,r]of e.entries())t[s]?Array.isArray(t[s])?t[s].push(r):t[s]=[t[s],r]:t[s]=r;return t}reset(){this.form.reset(),this.errors={},this.form.querySelectorAll("input, select, textarea").forEach(e=>{e.classList.remove(this.options.errorClass,this.options.successClass),this._removeErrorMessage(e)})}addRule(e,t,s){this.rules[e]=t,s&&(this.messages[e]=s)}getErrors(){return this.errors}isValid(){return 0===Object.keys(this.errors).length}}function i(e,t){new o(e,{validateOnSubmit:!1}).validate(t)}const n=o;class l{constructor(e={}){if(e.form){if(this.form=this._getElement(e.form),!this.form)throw new Error("Newsletter: Form element not found");this.messageHolder=e.messageHolder?this._getElement(e.messageHolder):null,this.messageHolder&&(this.messageElement=this.messageHolder.querySelector('[data-class*="message"]')||this.messageHolder.querySelector(".message"),this.closeElement=this.messageHolder.querySelector('[data-class*="close"]')||this.messageHolder.querySelector(".close")),this.submitUrl=e.submitUrl||"/common/newsletter",this.onSuccess=e.onSuccess||null,this.onError=e.onError||null,this.validator=new n(this.form,{validateOnBlur:!0,validateOnInput:!1,validateOnSubmit:!1,showErrors:!0,errorClass:"is-invalid",successClass:"is-valid",errorMessageClass:"invalid-feedback",...e.validatorOptions||{}}),this._init()}else this._initLegacyMode()}_initLegacyMode(){this.isLegacyMode=!0;let e="form[data-form='newsletter-form']";if(this.form=document.querySelector(e),this.form||(e="form[data-form='subscribe-form']",this.form=document.querySelector(e)),!this.form)return void console.warn("Newsletter: No form found in legacy mode");const t=e.includes("newsletter")?"newsletter":"subscribe";this.messageHolder=document.querySelector(`div[data-message-holder='${t}-message-holder']`),this.messageElement=document.querySelector(`span[data-class='${t}-message']`),this.closeElement=document.querySelector(`span[data-class='${t}-close']`),this.submitUrl="/common/newsletter",this.onSuccess=null,this.onError=null,this.validator=new n(this.form,{validateOnBlur:!0,validateOnInput:!1,validateOnSubmit:!1,showErrors:!0,errorClass:"is-invalid",successClass:"is-valid",errorMessageClass:"invalid-feedback"}),this._init()}_getElement(e){return"string"==typeof e?document.querySelector(e)||document.getElementById(e):e}_init(){this.form&&this.form.addEventListener("submit",e=>{e.preventDefault(),this.submit()}),this.closeElement&&this.closeElement.addEventListener("click",()=>{this.close()})}submit(){if(this.validator&&!this.validator.validate()){const e=this.validator.getErrors(),t=Object.values(e)[0];return t&&(this.showMessage(t.message,"error"),this.show()),this.onError&&this.onError({success:!1,message:t.message,errors:e}),!1}const e=this.validator?this.validator.getFormData():this._getFormData();return s.post(this.submitUrl,e).then(e=>!1===e.data.success?(this._handleError(e.data),e.data):(this._handleSuccess(e.data),e.data)).catch(e=>{throw this._handleError(e.response?e.response.data:{message:"Network error"}),e})}_handleSuccess(e){this.showMessage(e.message||"Successfully subscribed!","success"),this.show(),this.form&&this.form.reset(),this.validator&&this.validator.reset(),this.onSuccess&&this.onSuccess(e)}_handleError(e){let t="There was an error. Please try again.";e.message&&("object"==typeof e.message&&e.message.email&&e.message.email[0]?t=e.message.email[0]:"string"==typeof e.message&&(t=e.message)),this.showMessage(t,"error"),this.show(),this.onError&&this.onError(e)}_getFormData(){const e=new FormData(this.form),t={};for(const[s,r]of e.entries())t[s]=r;return t}showMessage(e,t="success"){this.messageElement&&(this.messageElement.innerText=e,"success"===t?(this.messageElement.classList.remove("text-danger"),this.messageElement.classList.add("text-success")):(this.messageElement.classList.remove("text-success"),this.messageElement.classList.add("text-danger")))}close(){this.messageHolder&&(this.messageHolder.style.display="none")}show(){this.messageHolder&&(this.messageHolder.style.display="")}newsletterNow(){return this.submit()}subscribeNow(){return this.submit()}}class c{constructor(e={}){if(e.form){if(this.form=this._getElement(e.form),!this.form)throw new Error("Contact: Form element not found");this.messageHolder=e.messageHolder?this._getElement(e.messageHolder):null,this.messageHolder&&(this.messageElement=this.messageHolder.querySelector('[data-class*="message"]')||this.messageHolder.querySelector(".message"),this.closeElement=this.messageHolder.querySelector('[data-class*="close"]')||this.messageHolder.querySelector(".close")),this.submitUrl=e.submitUrl||"/common/contact",this.onSuccess=e.onSuccess||null,this.onError=e.onError||null,this.onError=e.onError||null,this.validator=new n(this.form,{validateOnBlur:!0,validateOnInput:!1,validateOnSubmit:!1,showErrors:!0,errorClass:"is-invalid",successClass:"is-valid",errorMessageClass:"invalid-feedback",...e.validatorOptions||{}}),this._init()}else this._initLegacyMode()}_initLegacyMode(){this.isLegacyMode=!0,this.form=document.querySelector("form[data-form='contact-form']"),this.form?(this.messageHolder=document.querySelector("div[data-message-holder='contact-message-holder']"),this.messageElement=document.querySelector("span[data-class='contact-message']"),this.closeElement=document.querySelector("span[data-class='contact-close']"),this.submitUrl="/common/contact",this.onSuccess=null,this.onError=null,this.validator=new n(this.form,{validateOnBlur:!0,validateOnInput:!1,validateOnSubmit:!1,showErrors:!0,errorClass:"is-invalid",successClass:"is-valid",errorMessageClass:"invalid-feedback"}),this._init()):console.warn("Contact: No form found in legacy mode")}_getElement(e){return"string"==typeof e?document.querySelector(e)||document.getElementById(e):e}_init(){this.form&&this.form.addEventListener("submit",e=>{e.preventDefault(),this.submit()}),this.closeElement&&this.closeElement.addEventListener("click",()=>{this.close()})}submit(){if(this.validator&&!this.validator.validate()){const e=this.validator.getErrors(),t=Object.values(e)[0];return t&&(this.showMessage(t.message,"error"),this.show()),this.onError&&this.onError({success:!1,message:t.message,errors:e}),!1}const e=this.validator?this.validator.getFormData():this._getFormData();return s.post(this.submitUrl,e).then(e=>!1===e.data.success?(this._handleError(e.data),e.data):(this._handleSuccess(e.data),e.data)).catch(e=>{throw this._handleError(e.response?e.response.data:{message:"Network error"}),e})}_handleSuccess(e){this.showMessage(e.message||"Information have been saved successfully.","success"),this.show(),this.form&&this.form.reset(),this.validator&&this.validator.reset(),this.onSuccess&&this.onSuccess(e)}_handleError(e){let t="There was an error. Please try again.";e.message&&("object"==typeof e.message?t=Object.values(e.message).flat().join(", "):"string"==typeof e.message&&(t=e.message)),this.showMessage(t,"error"),this.show(),this.onError&&this.onError(e)}_getFormData(){const e=new FormData(this.form),t={};for(const[s,r]of e.entries())t[s]=r;return t}showMessage(e,t="success"){this.messageElement&&(this.messageElement.innerText=e,"success"===t?(this.messageElement.classList.remove("text-danger"),this.messageElement.classList.add("text-success")):(this.messageElement.classList.remove("text-success"),this.messageElement.classList.add("text-danger")))}close(){this.messageHolder&&(this.messageHolder.style.display="none")}show(){this.messageHolder&&(this.messageHolder.style.display="")}contactNow(){return this.submit()}}class h{constructor(e={}){this.options={enabled:!1!==e.enabled,onPageView:e.onPageView||null,onEvent:e.onEvent||null}}trackPageView(e,t){this.options.enabled&&this._trackGooglePageView(e),this.options.onPageView&&this.options.onPageView({url:e}),t&&t.apply(this,arguments)}trackEventView(e,t,s,r){this.options.enabled&&this._trackGoogleEvent(e,t,s),this.options.onEvent&&this.options.onEvent({category:e,action:t,value:s}),r&&r.apply(this,arguments)}_trackGoogleEvent(e,t,s){if("undefined"!=typeof window){try{void 0!==window._gaq&&window._gaq.push(["_trackEvent",e,t,s])}catch(e){}try{void 0!==window.ga&&window.ga("send",{hitType:"event",eventCategory:e,eventAction:t,eventLabel:s})}catch(e){}try{void 0!==window.gtag&&window.gtag("event",t,{event_category:e,event_label:s})}catch(e){}}}_trackGooglePageView(e){if("undefined"!=typeof window){try{void 0!==window._gaq&&window._gaq.push(["_trackPageview",e])}catch(e){}try{void 0!==window.ga&&window.ga("send",{hitType:"pageview",page:e})}catch(e){}try{void 0!==window.gtag&&window.gtag("config",window.GA_MEASUREMENT_ID||"GA_MEASUREMENT_ID",{page_path:e})}catch(e){}}}setEnabled(e){this.options.enabled=e}isEnabled(){return this.options.enabled}}class u{constructor(e={}){this.options={publishUrl:e.publishUrl||"/api/hashtagcms/public/kpi/v1/publish",onPublish:e.onPublish||null,onError:e.onError||null,onPageView:e.onPageView||null,onEvent:e.onEvent||null,enableGoogleAnalytics:!1!==e.enableGoogleAnalytics,enableBeacon:!1!==e.enableBeacon,...e},this.google=new h({enabled:this.options.enableGoogleAnalytics,onPageView:this.options.onPageView,onEvent:this.options.onEvent})}publish(e,t){const s=this.options.publishUrl;if(this.options.enableBeacon&&"undefined"!=typeof navigator&&navigator.sendBeacon)try{const r=new Blob([JSON.stringify(e)],{type:"application/json"});if(navigator.sendBeacon(s,r))return this.options.onPublish&&this.options.onPublish(e,null,{beaconSent:!0}),t&&t(null,{success:!0,beaconSent:!0}),Promise.resolve({success:!0,beaconSent:!0});console.warn("Analytics: sendBeacon failed (returned false)")}catch(e){console.warn("Analytics: sendBeacon error, falling back to axios",e)}return this.submit("post",s,e).then(s=>(this.options.onPublish&&this.options.onPublish(e,s,{beaconSent:!1}),t&&t(null,s),s)).catch(s=>{throw this.options.onError&&this.options.onError(s,e),t&&t(s),s})}submit(e,t,s){return new Promise((r,a)=>{axios[e](t,s).then(e=>{r(e.data)}).catch(e=>{a(e.response?e.response.data:e)})})}trackPageView(e,t){return this.google.trackPageView(e,t)}trackCmsPage(e,t){if(!e||"object"!=typeof e){const e=new Error("trackCmsPage: data must be an object");if(t)return t(e),Promise.reject(e);throw e}if(!e.categoryId){const e=new Error("trackCmsPage: categoryId is required");if(t)return t(e),Promise.reject(e);throw e}if(!Number.isInteger(e.categoryId)){const e=new Error("trackCmsPage: categoryId must be an integer");if(t)return t(e),Promise.reject(e);throw e}if(void 0!==e.pageId&&null!==e.pageId&&!Number.isInteger(e.pageId)){const e=new Error("trackCmsPage: pageId must be an integer");if(t)return t(e),Promise.reject(e);throw e}const s={...e};return void 0!==s.pageId&&null!==s.pageId&&s.pageId<1&&(s.pageId=null),s.event="category_page_view",this.publish(s,t)}setOption(e,t){this.options[e]=t,"enableGoogleAnalytics"===e&&this.google.setEnabled(t)}getOption(e,t){return void 0!==this.options[e]?this.options[e]:t}}class m{constructor(e){this.configData=this._parseData(e)}_parseData(e){if(null==e)return{};if("string"==typeof e)try{const t=JSON.parse(e);return"object"==typeof t&&null!==t?t:{}}catch(e){return console.warn("AppConfig: Failed to parse JSON string, using empty config",e),{}}return"object"==typeof e&&null!==e?e:(console.warn("AppConfig: Invalid data type, expected object or JSON string, got",typeof e),{})}setConfigData(e){this.configData=this._parseData(e)}getValue(e,t){if(!e)return t;try{return e.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,this.configData)??t}catch(e){return t}}getMedia(e){const t=this.getValue("media");return t&&t.http_path?t.http_path+"/"+e:(console.warn("AppConfig: media.http_path not configured"),e)}getAll(){return this.configData}has(e){return e in this.configData}}const d={Newsletter:l,Subscribe:l,FormSubmitter:l,Contact:c,Analytics:u,AppConfig:m,FormValidator:n,validateForm:i};"undefined"!=typeof window&&(window.HashtagCms=d);const g=d;export{u as Analytics,m as AppConfig,c as Contact,l as FormSubmitter,n as FormValidator,l as Newsletter,l as Subscribe,g as default,i as validateForm};